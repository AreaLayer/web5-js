<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Travel Weather App</title>
  <style>
    body {
      font-family: 'Press Start 2P', cursive;
      background-color: yellow;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    form {
      display: flex;
      flex-direction: column;
      margin-top: 1rem;
    }

    label {
      font-size: 1.2rem;
    }

    input {
      font-family: 'Press Start 2P', cursive;
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }

    button {
      font-family: 'Press Start 2P', cursive;
      font-size: 1.2rem;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>

<body>
  <h1>Travel Weather App</h1>

  <form id="travel-form">
    <label for="name-input">Name:</label>
    <input type="text" id="name-input" required>

    <label for="destination-input">Destination:</label>
    <input type="text" id="destination-input" required>

    <label for="date-input">Date:</label>
    <input type="date" id="date-input" required>

    <button type="submit">Save and check weather</button>
  </form>

  <script type="module">
    import { Web5, DWebNodeSDK } from 'https://cdn.jsdelivr.net/npm/@tbd54566975/web5@v0.2.0-unstable.03d4273-2023.3.17-04-09-58/dist/browser.mjs';

    // Create a new ION DID and public-private key pair. This always has to be done once. 
    const myDid = await Web5.did.create('ion', {
      services: [{
        'id': 'dwn',
        'type': 'DecentralizedWebNode',
        'serviceEndpoint': {
          'nodes': ['https://dwn-usa-1.ue8cktdq71va0.us-east-2.cs.amazonlightsail.com/']
        }
      }]
    });

    // Register the DID as one which is running in browser and for which keys are available to sign messages.
    Web5.did.register({
      connected: true,
      did: myDid.id,
      endpoint: 'app://dwn',
      keys: myDid.keys[0].keypair
    });

    const form = document.querySelector('#travel-form');
    const nameInput = document.querySelector('#name-input');
    const destinationInput = document.querySelector('#destination-input');
    const dateInput = document.querySelector('#date-input');

    form.addEventListener('submit', async (event) => {
      event.preventDefault();

      // Write the travel information to the DWN
      const response = await Web5.records.write(myDid.id, {
        author: myDid.id,
        data: {
          name: nameInput.value,
          destination: destinationInput.value,
          date: dateInput.value
        },
        message:{
schema: 'travel-info',
dataFormat: 'application/json'
}
});  // Show a confirmation message
  alert('Travel information saved to DWN!');

  // Retrieve the weather for the destination and date using the OpenWeatherMap API
  const apiKey = 'YOUR_API_KEY_HERE';
  const city = encodeURIComponent(destinationInput.value);
  const date = encodeURIComponent(dateInput.value);
  const apiUrl = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&dt=${date}`;

  const weatherResponse = await fetch(apiUrl);
  const weatherData = await weatherResponse.json();

  // Display the weather information
  const temperature = Math.round(weatherData.main.temp - 273.15);
  const description = weatherData.weather[0].description;

  alert(`The temperature in ${destinationInput.value} on ${dateInput.value} will be ${temperature}Â°C with ${description}.`);
});
</script>
</body>
</html>
